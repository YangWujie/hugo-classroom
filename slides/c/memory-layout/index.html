<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>内存布局</title>
<meta name="description" content="一个试验性的教学网站">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/hugo-classroom/reveal-js/css/reset.css">
<link rel="stylesheet" href="/hugo-classroom/reveal-js/css/reveal.css"><link rel="stylesheet" href="/hugo-classroom/reveal-js/css/theme/black.css" id="theme">
<link rel="stylesheet" href="/hugo-classroom/highlight-js/default.min.css">
    
  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    
<section data-noprocess data-shortcode-slide
      data-transition="zoom">
  
<p>C语言程序的</p>
<h1 id="内存布局">内存布局</h1>
</section><section>
<ul>
<li><code>memory-layout.c:</code>一个极简C程序框架</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section>

<section data-noprocess data-shortcode-slide
      data-transition="zoom">
  
<h1 id="数据段和代码段">数据段和代码段</h1>
</section><section>
<ul>
<li>用<code>gcc</code>建造该程序，并用GNU工具<code>size</code>查看可执行程序中各部分的大小：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span>$ gcc memory-layout.c -o memory-layout
</span></span><span style="display:flex;"><span>$ size memory-layout
</span></span></code></pre></div><pre tabindex="0"><code class="nohighlight" data-noescape>   text    data     bss     dec     hex filename
   1418     544       8    1970     7b2 memory-layout
</code></pre></section><section>
<ul>
<li>给程序增加一个全局变量：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="nohighlight" data-noescape><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#66d9ef">double</span> global;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span>$ gcc memory-layout.c -o memory-layout
</span></span><span style="display:flex;"><span>$ size memory-layout
</span></span></code></pre></div><pre tabindex="0"><code class="nohighlight" data-noescape>   text    data     bss     dec     hex filename
   1418     544      16    1978     7ba memory-layout
</code></pre><ul>
<li>再次查看，比较两次的数据差异可知，变量<code>global</code>位于<code>bss</code>段。</li>
</ul>
</section><section>
<h2 id="bsshttpsenwikipediaorgwikibss"><a href="https://en.wikipedia.org/wiki/.bss">bss</a></h2>
<ul>
<li>这是一个被沿用的古老的名字。</li>
<li>是block starting symbol的缩写。</li>
<li>其中的数据未被初始化，所以在目标文件中只记录大小，但并不占用空间。</li>
<li>程序运行时，在内存为bss中的数据分配空间，默认值为0。</li>
</ul>
</section><section>
<h2 id="问题">问题</h2>
<ul>
<li>请想办法验证bss中的数据在目标文件中真的不占用空间，并说明为什么可以这样？</li>
</ul>
</section><section>
<ul>
<li>给程序增加两个静态变量：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="nohighlight" data-noescape><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#66d9ef">double</span> global;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>{
</span></span><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> i, j;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span>$ gcc memory-layout.c -o memory-layout
</span></span><span style="display:flex;"><span>$ size memory-layout
</span></span></code></pre></div><pre tabindex="0"><code class="nohighlight" data-noescape>   text    data     bss     dec     hex filename
   1418     544      24    1986     7c2 memory-layout
</code></pre><ul>
<li>再次查看，比较两次的数据差异可知，静态变量亦位于<code>bss</code>段。</li>
<li>这里之所以加了两个静态变量是因为在64位系统中，数据通常是8字节对齐的，单个4字节的整形变量可能不足以导致数字上可观察的变化。</li>
</ul>
</section><section>
<ul>
<li>给全局变量赋初值：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="nohighlight" data-noescape><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#66d9ef">double</span> global <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> i, j;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span>$ gcc memory-layout.c -o memory-layout
</span></span><span style="display:flex;"><span>$ size memory-layout
</span></span></code></pre></div><pre tabindex="0"><code class="nohighlight" data-noescape>   text    data     bss     dec     hex filename
   1418     552      16    1986     7c2 memory-layout
</code></pre><ul>
<li>再次查看，发现<code>bss</code>段便小了，<code>data</code>段变大了</li>
<li>由此可知，变量<code>global</code>从<code>bss</code>段移到了<code>data</code>段</li>
</ul>
</section><section>
<ul>
<li>再增加一个全局变量：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="nohighlight" data-noescape><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>greetings <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello World!&#34;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#66d9ef">double</span> global <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> i, j;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span>$ gcc memory-layout.c -o memory-layout
</span></span><span style="display:flex;"><span>$ size memory-layout
</span></span></code></pre></div><pre tabindex="0"><code class="nohighlight" data-noescape>   text    data     bss     dec     hex filename
   1455     560      16    2031     7ef memory-layout
</code></pre><ul>
<li>再次查看，发现<code>data</code>段变大了，这是因为增加了全局变量<code>greetings</code>的结果</li>
<li>但<code>text</code>也增加了。为什么？</li>
</ul>
</section><section>
<p>原因</p>
<ul>
<li><code>greetings</code>的数据类型是字符指针，变量本身位于<code>data</code>段。</li>
<li><code>greetings</code>指向的目标，即字符串内容本身被放在<code>text</code>段。</li>
<li>所以，<code>data</code>段和<code>text</code>段同时增大了。</li>
<li>程序指令也处于<code>text</code>段。</li>
<li>和<code>data</code>段不同，<code>text</code>段只允许读，不允许写。</li>
</ul>
</section><section>





<div style="font-size:12px" class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 352 201"
      >
      <g transform='translate(8,16)'>
<path d='M 96,16 L 248,16' fill='none' stroke='currentColor'></path>
<path d='M 64,32 L 96,32' fill='none' stroke='currentColor'></path>
<path d='M 96,32 L 168,32' fill='none' stroke='currentColor'></path>
<path d='M 96,48 L 248,48' fill='none' stroke='currentColor'></path>
<path d='M 64,128 L 88,128' fill='none' stroke='currentColor'></path>
<path d='M 96,128 L 248,128' fill='none' stroke='currentColor'></path>
<path d='M 96,160 L 248,160' fill='none' stroke='currentColor'></path>
<path d='M 64,32 L 64,128' fill='none' stroke='currentColor'></path>
<path d='M 96,0 L 96,16' fill='none' stroke='currentColor'></path>
<path d='M 96,16 L 96,32' fill='none' stroke='currentColor'></path>
<path d='M 96,32 L 96,48' fill='none' stroke='currentColor'></path>
<path d='M 96,48 L 96,64' fill='none' stroke='currentColor'></path>
<path d='M 96,112 L 96,128' fill='none' stroke='currentColor'></path>
<path d='M 96,128 L 96,160' fill='none' stroke='currentColor'></path>
<path d='M 96,160 L 96,176' fill='none' stroke='currentColor'></path>
<path d='M 248,0 L 248,16' fill='none' stroke='currentColor'></path>
<path d='M 248,16 L 248,48' fill='none' stroke='currentColor'></path>
<path d='M 248,48 L 248,64' fill='none' stroke='currentColor'></path>
<path d='M 248,112 L 248,128' fill='none' stroke='currentColor'></path>
<path d='M 248,128 L 248,160' fill='none' stroke='currentColor'></path>
<path d='M 248,160 L 248,176' fill='none' stroke='currentColor'></path>
<polygon points='96.000000,128.000000 84.000000,122.400002 84.000000,133.600006' fill='currentColor' transform='rotate(0.000000, 88.000000, 128.000000)'></polygon>
<circle cx='168' cy='32' r='6' stroke='currentColor' fill='currentColor'></circle>
<text text-anchor='middle' x='48' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='48' y='180' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='56' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='56' y='180' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='64' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='64' y='180' fill='currentColor' style='font-size:1em'>x</text>
<text text-anchor='middle' x='72' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='72' y='180' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='120' y='148' fill='currentColor' style='font-size:1em'>"</text>
<text text-anchor='middle' x='128' y='148' fill='currentColor' style='font-size:1em'>H</text>
<text text-anchor='middle' x='136' y='148' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='144' y='148' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='152' y='148' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='160' y='148' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='176' y='148' fill='currentColor' style='font-size:1em'>W</text>
<text text-anchor='middle' x='184' y='148' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='192' y='148' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='200' y='148' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='208' y='148' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='216' y='148' fill='currentColor' style='font-size:1em'>!</text>
<text text-anchor='middle' x='224' y='148' fill='currentColor' style='font-size:1em'>"</text>
<text text-anchor='middle' x='272' y='36' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='280' y='36' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='288' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='296' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='304' y='36' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='312' y='36' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='320' y='36' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='328' y='36' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='336' y='36' fill='currentColor' style='font-size:1em'>s</text>
</g>

    </svg>
  
</div></section><section>
<ul>
<li>试图把“Hello World!”中的大写H改为小写：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="nohighlight" data-noescape><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>greetings <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello World!&#34;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#66d9ef">double</span> global <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> i, j;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	<span style="color:#f92672">*</span>greetings <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;h&#39;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span>$ gcc memory-layout.c -o memory-layout
</span></span><span style="display:flex;"><span>$ ./memory-layout
</span></span></code></pre></div><pre tabindex="0"><code class="nohighlight" data-noescape>Segmentation fault (core dumped)
</code></pre><ul>
<li>这个程序运行时会发生如上错误。你能指出错误原因吗？</li>
</ul>
</section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> no;
</span></span><span style="display:flex;"><span>	printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, no<span style="color:#f92672">++</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>		foo();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>请猜测上面的程序输出的信息是什么，然后运行程序验证你的猜测。</li>
</ul>
</section><section>
<p>总结</p>
<ul>
<li>未初始化的全局变量和静态变量位于bss段。bss段在目标文件中不占空间，程序运行时被分配内存并初始化为0。</li>
<li>已初始化的全局变量和静态变量位于data段。</li>
<li>程序指令和字符串位于text段。</li>
<li>bss段和data段可读可写，text段只可读不可写。</li>
<li>这些段中的数据的生命周期等同于程序的生命周期，即这些段中的内存不需要分配和回收管理。</li>
</ul>
</section>

<section data-noprocess data-shortcode-slide
      data-transition="zoom">
  
<h1 id="栈">栈</h1>
</section><section>
<p><img src="book_stack.jpg" alt="book stack"></p>
</section><section>
<ul>
<li>一个先进后出的数据结构</li>
<li>非常契合函数之间的调用关系：函数A调用函数B，函数B调用函数C。返回时的顺序则是从C返回B，然后从B返回A。</li>
<li>把函数调用时的返回地址顺次压栈，即可实现我们期望的函数调用和返回关系。</li>
<li>函数内定义的局部变量，在函数被调用时在栈里分配空间，函数返回时回收。</li>
<li>因为局部变量在栈里分配空间，管理起来也方便，所以也叫栈变量、自动变量。</li>
</ul>
</section><section>
<ul>
<li>在<code>main</code>里定义两个局部变量：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="nohighlight" data-noescape><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>greetings <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello World!&#34;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#66d9ef">double</span> global <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> i, j;
</span></span><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	<span style="color:#66d9ef">int</span> m, n;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span>$ gcc memory-layout.c -o memory-layout
</span></span><span style="display:flex;"><span>$ size memory-layout
</span></span></code></pre></div><pre tabindex="0"><code class="nohighlight" data-noescape>   text    data     bss     dec     hex filename
   1455     560      16    2031     7ef memory-layout
</code></pre><ul>
<li>再次查看，没有任何变化</li>
<li>说明局部变量不在<code>data</code>和<code>bss</code>段中分配内存</li>
</ul>
</section><section>
<ul>
<li>栈有大小限制。</li>
<li>当函数调用层次过深时，有可能会发生栈溢出现象。</li>
</ul>
</section><section>
<ul>
<li>这是一个用递归算法写的计算阶乘的程序；</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">factorial</span>(<span style="color:#66d9ef">int</span> n)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> n <span style="color:#f92672">*</span> factorial(n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> n;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;Please input a number: &#34;</span>);
</span></span><span style="display:flex;"><span>        scanf(<span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>n);
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;Factorial of %d is %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, n, factorial(n));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<ul>
<li>运行该程序，得到的结果如下。请解释这些现象。</li>
</ul>
<pre tabindex="0"><code class="nohighlight" data-noescape>输入10时，得到的结果：

Factorial of 10 is 3628800


输入100时，得到的结果：

Factorial of 10 is 0


输入1000000时，得到的结果：

Segmentation fault (core dumped)
</code></pre></section><section>
<ul>
<li>根据你的理解，请问你能找到一种简单的方法判定在你的系统里，栈是向地址增大或是减小的方向扩展吗？</li>
</ul>
</section><section>
<ul>
<li>一个古怪的程序</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> f;
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;%X</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, f);
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeadbeef</span>;
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;%X</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, f);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">bar</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> b;
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;%X</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, b);
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xcafebabe</span>;
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;%X</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, b);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        foo();
</span></span><span style="display:flex;"><span>        bar();
</span></span><span style="display:flex;"><span>        foo();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<pre tabindex="0"><code class="nohighlight" data-noescape>5577
DEADBEEF
DEADBEEF
CAFEBABE
CAFEBABE
DEADBEEF
</code></pre><ul>
<li>程序的输出是上面那个样子。你能解释原因吗？</li>
</ul>
</section>

<section data-noprocess data-shortcode-slide
      data-transition="zoom">
  
<h1 id="堆">堆</h1>
<p>heap</p>
</section><section>
<ul>
<li>用<code>malloc</code>在堆里分配内存。</li>
<li>在堆里分配的内存，最终需要用<code>free</code>释放返回。</li>
<li>全局变量、局部变量的生命周期不受程序员控制，但堆变量的生命周期完全受控于程序员，可以提供最大的灵活性。</li>
<li>你可以把堆简单想象成一个仓库，里面储满了内存。需要时从里面取一块，用完了还回去。如果用了不还，会导致可用内存越来越少，最终可能导致程序出错。</li>
</ul>
</section><section>
<ul>
<li>堆变量的生命周期相互独立，先分配的未必先释放。经过一段时间的使用之后，堆可能变成下面这样的筛子样：已分配出去的内存块和空闲的内存块交错排列。</li>
</ul>





<div style="font-size:12px" class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 240 121"
      >
      <g transform='translate(8,16)'>
<path d='M 48,0 L 176,0' fill='none' stroke='currentColor'></path>
<path d='M 48,96 L 176,96' fill='none' stroke='currentColor'></path>
<path d='M 48,0 L 48,96' fill='none' stroke='currentColor'></path>
<path d='M 176,0 L 176,96' fill='none' stroke='currentColor'></path>
<rect x='52' y='8' width='8' height='16' fill='currentColor'></rect><rect x='52' y='40' width='8' height='16' fill='currentColor'></rect><rect x='52' y='72' width='8' height='16' fill='currentColor'></rect><rect x='60' y='8' width='8' height='16' fill='currentColor'></rect><rect x='60' y='40' width='8' height='16' fill='currentColor'></rect><rect x='60' y='72' width='8' height='16' fill='currentColor'></rect><rect x='68' y='24' width='8' height='16' fill='currentColor'></rect><rect x='68' y='56' width='8' height='16' fill='currentColor'></rect><rect x='68' y='72' width='8' height='16' fill='currentColor'></rect><rect x='76' y='24' width='8' height='16' fill='currentColor'></rect><rect x='76' y='56' width='8' height='16' fill='currentColor'></rect><rect x='76' y='72' width='8' height='16' fill='currentColor'></rect><rect x='84' y='8' width='8' height='16' fill='currentColor'></rect><rect x='84' y='40' width='8' height='16' fill='currentColor'></rect><rect x='84' y='72' width='8' height='16' fill='currentColor'></rect><rect x='92' y='8' width='8' height='16' fill='currentColor'></rect><rect x='92' y='40' width='8' height='16' fill='currentColor'></rect><rect x='100' y='8' width='8' height='16' fill='currentColor'></rect><rect x='100' y='24' width='8' height='16' fill='currentColor'></rect><rect x='100' y='56' width='8' height='16' fill='currentColor'></rect><rect x='108' y='8' width='8' height='16' fill='currentColor'></rect><rect x='108' y='24' width='8' height='16' fill='currentColor'></rect><rect x='108' y='56' width='8' height='16' fill='currentColor'></rect><rect x='108' y='72' width='8' height='16' fill='currentColor'></rect><rect x='116' y='8' width='8' height='16' fill='currentColor'></rect><rect x='116' y='40' width='8' height='16' fill='currentColor'></rect><rect x='116' y='72' width='8' height='16' fill='currentColor'></rect><rect x='124' y='8' width='8' height='16' fill='currentColor'></rect><rect x='124' y='40' width='8' height='16' fill='currentColor'></rect><rect x='124' y='72' width='8' height='16' fill='currentColor'></rect><rect x='132' y='8' width='8' height='16' fill='currentColor'></rect><rect x='132' y='40' width='8' height='16' fill='currentColor'></rect><rect x='132' y='72' width='8' height='16' fill='currentColor'></rect><rect x='140' y='8' width='8' height='16' fill='currentColor'></rect><rect x='140' y='40' width='8' height='16' fill='currentColor'></rect><rect x='140' y='72' width='8' height='16' fill='currentColor'></rect><rect x='148' y='40' width='8' height='16' fill='currentColor'></rect><rect x='156' y='24' width='8' height='16' fill='currentColor'></rect><rect x='156' y='56' width='8' height='16' fill='currentColor'></rect><rect x='164' y='24' width='8' height='16' fill='currentColor'></rect><rect x='164' y='56' width='8' height='16' fill='currentColor'></rect></g>

    </svg>
  
</div></section><section>
<h2 id="堆内存的应用场景">堆内存的应用场景</h2>
<ul>
<li>函数返回后仍然要用到的数据应该放到堆里，如果你不希望它和程序具有同样的生命周期的话。</li>
</ul>
</section><section>
<ul>
<li>堆变量在使用之前需要先用<code>malloc</code>分配</li>
<li>堆变量用完之后用<code>free</code>释放</li>
<li>释放之后不允许继续使用</li>
<li>只能释放一次</li>
</ul>
</section><section>
<ul>
<li>一个使用堆的简单例子：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// This pointer will hold the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// base address of the block created
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> ptr;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> n, i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Get the number of elements for the array
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	printf(<span style="color:#e6db74">&#34;Enter number of elements:&#34;</span>);
</span></span><span style="display:flex;"><span>	scanf(<span style="color:#e6db74">&#34;%d&#34;</span>,<span style="color:#f92672">&amp;</span>n);
</span></span><span style="display:flex;"><span>	printf(<span style="color:#e6db74">&#34;Entered number of elements: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, n);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Dynamically allocate memory using malloc()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	ptr <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span>)malloc(n <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Check if the memory has been successfully
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// allocated by malloc or not
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> (ptr <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>		printf(<span style="color:#e6db74">&#34;Memory not allocated.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>		exit(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Memory has been successfully allocated
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		printf(<span style="color:#e6db74">&#34;Memory successfully allocated using malloc.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Get the elements of the array
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>			ptr[i] <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Print the elements of the array
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		printf(<span style="color:#e6db74">&#34;The elements of the array are: &#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>			printf(<span style="color:#e6db74">&#34;%d, &#34;</span>, ptr[i]);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	free(ptr);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<ul>
<li>堆变量听起来和看起来是不是特简单？</li>
<li>不要被它人畜无害的样子骗了。C程序中的大量bug都和它有关。</li>
<li>正是由于C的这个痛点，才催生了Java、Python、Go等采用<a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">Garbage Clloection</a>技术的语言。</li>
</ul>
</section><section>
<h2 id="常见错误">常见错误</h2>
<ul>
<li>请指出以下各代码片段中的错误</li>
</ul>
</section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>p;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>p <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>n;
</span></span><span style="display:flex;"><span>	(<span style="color:#f92672">*</span>p)<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>	free(p);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>p;
</span></span><span style="display:flex;"><span>	free(p);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>p <span style="color:#f92672">=</span> malloc(<span style="color:#ae81ff">128</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>p;
</span></span><span style="display:flex;"><span>	p <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)malloc(<span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>	free(p);
</span></span><span style="display:flex;"><span>	free(p);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> x {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> data;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">foo</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">struct</span> x <span style="color:#f92672">*</span>p;
</span></span><span style="display:flex;"><span>	p <span style="color:#f92672">=</span> (<span style="color:#66d9ef">struct</span> x <span style="color:#f92672">*</span>) malloc(<span style="color:#66d9ef">sizeof</span> (<span style="color:#66d9ef">struct</span> x));
</span></span><span style="display:flex;"><span>	p<span style="color:#f92672">-&gt;</span>data <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>	free(p);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> p<span style="color:#f92672">-&gt;</span>data;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="happy-hacking">Happy Hacking</h2>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src=/hugo-classroom/reveal-hugo/object-assign.js></script>

<a href="/hugo-classroom/reveal-js/css/print/" id="print-location" style="display: none;"></a>
<script type="text/javascript">
  var printLocationElement = document.getElementById('print-location');
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = printLocationElement.href + (window.location.search.match(/print-pdf/gi) ? 'pdf.css' : 'paper.css');
  document.getElementsByTagName('head')[0].appendChild(link);
</script>

<script type="application/json" id="reveal-hugo-site-params">null</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/hugo-classroom/reveal-js/js/reveal.js"></script>

<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }
  
  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams));
  Reveal.initialize(options);
</script>


  
  
  <script type="text/javascript" src="/hugo-classroom/reveal-js/plugin/markdown/marked.js"></script>
  
  <script type="text/javascript" src="/hugo-classroom/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/hugo-classroom/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/hugo-classroom/reveal-js/plugin/zoom-js/zoom.js"></script>
  
  
  <script type="text/javascript" src="/hugo-classroom/reveal-js/plugin/notes/notes.js"></script>














  




























































  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({startOnLoad: false});
    let render = (event) => {
      let mermaidElems = event.currentSlide.querySelectorAll('.mermaid');
      if (!mermaidElems.length){
          return
      }
      mermaidElems.forEach(mermaidElem => {
          let processed = mermaidElem.getAttribute('data-processed');
          if (!processed){
              
              mermaid.init(undefined, mermaidElem);
          }
      });
    };
    Reveal.addEventListener('slidechanged', render);
    Reveal.addEventListener('ready', render);
  </script>

    
    
  </body>
</html>
